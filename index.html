<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="#ffffff" name="theme-color">
    <link href="/cdn/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
    <title>Login - Futbola</title>
    <style>
        .centrado {
            width: 80%;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            position: absolute;
            text-align: center;
        }

        * {
            padding: 0;
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
<div class="centrado">
    <button id="botonInicia" onclick="preparar()">Clic para iniciar</button>
</div>
<canvas height="3" id="myCanvas" width="4"></canvas>
<script>
    'use strict'
    let fps = 1;
    let intervalo = 1000 / fps;

    function Jugador(dorsal, equipo) {
        let x = 0;
        let y = 0;
        let i = dorsal;
        let color = equipo ? 'blue' : 'red';
        this.dibujar = function (ctx) {
        }
    }

    function Equipo(anchoCampo, altocampo, tamano, izquierda) {
        let jugadores = [];
        let ancho = anchoCampo;
        let alto = altocampo;
        let radio = tamano;
        let azul = !!izquierda;
        for (let i = 1; i < 11; i++) {
            jugadores.push(new Jugador(i));
        }

        this.dibujar = function (ctx) {
            jugadores.forEach(function (jugador) {
                jugador.dibujar(ctx);
            })
        }
        this.actualizar = function () {
        }
    }

    function Balon(xInicial, yInicial, tamano, minX, minY, maxX, maxY) {
        const maxVel = tamano * 7;
        let x = xInicial;
        let y = yInicial;
        let vx = 0;
        let vy = 0;
        let vel = 0;
        let radio = tamano;
        let arCompleto = Math.PI * 2;
        this.dibujar = function (ctx) {
            ctx.beginPath();
            ctx.arc(x, y, radio, 0, arCompleto);
            ctx.fillStyle = "#FFF";
            ctx.fill();
            ctx.closePath();
        }
        this.actualizar = function (nuevoX, nuevoY, velX, velY, nuevoVel) {
            x = nuevoX || x;
            y = nuevoY || y;
            vx = velX || vx;
            vy = velY || vy;
            vel = nuevoVel || vel;
            vel = vel > maxVel ? maxVel : vel;
            if (x + vx * vel > maxX || x + vx * vel < minX) {
                vx = -vx;
                vel++;
            }
            if (y + vy * vel > maxY || y + vy * vel < minY) {
                vy = -vy;
                vel++;
            }
            x = x + vx * vel;
            y = y + vy * vel;
        }
    }

    function Juego() {
        let ctx = null;

        let equipoA = null;
        let equipoB = null;
        let balon = null;

        let minX = 0;
        let minY = 0;
        let maxX = 0;
        let maxY = 0;
        let alto = 0;
        let ancho = 0;
        let bombaAncho = 0;
        let bombaAlto = 0;
        let bombaMinY = 0;
        let bombaDerMinX = 0;
        let mitadX;
        let mitadY;
        let radioCentro;
        let radioCompleto;
        let radioMitad;
        let radioAngulo;
        let bombaIzqMinXRadio;
        let bombaChicaAncho;
        let bombaChicaAlto;
        let bombaChicaMinY;
        let bombaChicaDerMinX;
        let porteriaMinY;
        let porteriaMaxY;

        this.inicia = function (elctx) {
            ctx = elctx;
            let bordes = 1 / 100;
            minX = ctx.canvas.width * bordes;
            minY = ctx.canvas.height * bordes;
            maxX = ctx.canvas.width - ctx.canvas.width * bordes;
            maxY = ctx.canvas.height - ctx.canvas.height * bordes;

            alto = maxY - minY;
            ancho = maxX - minX;

            bombaAncho = ancho / 7;
            bombaAlto = alto / 2;
            bombaMinY = minY + alto / 4;
            bombaDerMinX = maxX - bombaAncho;

            bombaChicaAncho = ancho / 18;
            bombaChicaAlto = alto / 4;
            bombaChicaMinY = bombaMinY + alto / 8;
            bombaChicaDerMinX = maxX - bombaChicaAncho;

            bombaIzqMinXRadio = minX + bombaAncho;

            mitadX = ctx.canvas.width / 2;
            mitadY = ctx.canvas.height / 2;

            radioCentro = bombaAncho / 3;
            radioCompleto = Math.PI * 2;
            radioMitad = Math.PI / 2;
            radioAngulo = Math.PI;

            porteriaMinY = minY + 4 * alto / 9;
            porteriaMaxY = alto / 9;

            let tamanoBalon = (ancho + alto) / 450;
            balon = new Balon(mitadX, mitadY, tamanoBalon, minX, minY, maxX, maxY);

            let tamanoJugador = tamanoBalon * 2
            equipoA = new Equipo(ancho, alto, tamanoJugador);
            equipoB = new Equipo(ancho, alto, tamanoJugador);

            balon.actualizar(null, null, Math.random() - Math.random(), Math.random() - Math.random(), tamanoBalon);
            ciclo();
        }

        function dibujarCampo() {
            //dibujamos el fondo verde
            ctx.beginPath();
            ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);
            ctx.fillStyle = "rgba(0, 120, 24, 0.9)";
            ctx.fill();
            ctx.closePath();

            //bordes de la cancha
            ctx.beginPath();
            ctx.rect(minX, minY, ancho, alto);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();

            //bomba izquierda y derecha
            ctx.beginPath();
            ctx.rect(minX, bombaMinY, bombaAncho, bombaAlto);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.rect(minX, bombaChicaMinY, bombaChicaAncho, bombaChicaAlto);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.arc(bombaIzqMinXRadio, mitadY, radioCentro, -radioMitad, radioMitad);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.rect(bombaDerMinX, bombaMinY, bombaAncho, bombaAlto);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.arc(bombaDerMinX, mitadY, radioCentro, radioMitad, -radioMitad);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.rect(bombaChicaDerMinX, bombaChicaMinY, bombaChicaAncho, bombaChicaAlto);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();

            //linea de la mitad y circulo
            ctx.beginPath();
            ctx.rect(mitadX, minY, 0, alto);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.arc(mitadX, mitadY, radioCentro, 0, radioCompleto);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();

            //porterias
            ctx.beginPath();
            ctx.rect(0, porteriaMinY, minX, porteriaMaxY);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.rect(maxX, porteriaMinY, minX, porteriaMaxY);
            ctx.strokeStyle = "#FFF";
            ctx.stroke();
            ctx.closePath();
        }

        function dibujar() {
            //Limpiar
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            dibujarCampo();
            //equipos
            equipoA.dibujar(ctx);
            equipoB.dibujar(ctx);
            balon.dibujar(ctx);
        }

        function actualizar() {
            balon.actualizar();
            equipoA.actualizar();
            equipoB.actualizar();
        }

        function ciclo() {
            actualizar();
            dibujar()
            //setTimeout(ciclo, intervalo);
            requestAnimationFrame(ciclo);
        }

    }


    /**
     *
     */
    function preparar() {
        document.getElementById('botonInicia').remove();

        const ancho = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        const alto = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);

        document.getElementById("myCanvas");
        let canvas = document.getElementById("myCanvas");
        let ctx = canvas.getContext("2d");

        ctx.canvas.width = ancho;
        ctx.canvas.height = alto;

        let juego = new Juego();
        juego.inicia(ctx);
    }

    /**
     *
     */
    window.onload = function () {
        setTimeout(preparar, 100);
    }

    window.addEventListener('keyup', function (event) {
        if (event.key !== undefined) {
            tecleo(event.key, 'Key');
        } else if (event.keyIdentifier !== undefined) {
            tecleo(event.keyIdentifier, 'keyIdentifier');
        } else if (event.keyCode !== undefined) {
            tecleo(event.keyCode, 'keyCode');
        }
    }, false);

    function tecleo(evento, tipo) {
        switch (evento) {
            case 'ArrowUp':
                fps++;
                intervalo = 1000 / fps;
                console.log(fps);
                break
            case 'ArrowDown':
                fps--;
                intervalo = 1000 / fps;
                console.log(fps);
                break
            default:
                break;
        }
    }

</script>

</body>
</html>
