<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <!-- MATERIAL DESIGN -->
    <link href="https://code.getmdl.io/1.3.0/material.teal-pink.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta content="#ffffff" name="theme-color">
    <link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
    <title>Login - Futbola</title>
    <style>
        .centrado {
            width: 50%;
            max-width: 960px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            position: absolute;
            text-align: center;
            background: url(fondo-menu.jpg) no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            height: 70vh;
            min-height: 50vh;
        }

        * {
            padding: 0;
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
        }

        body {
            background: url(fondo-inicio.jpg) no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }

        .menu {
            margin: 25vh;
        }

        .menu > p {
            margin-top: 1vh;
        }

        .oculto {
            visibility: hidden;
            position: absolute;
        }
    </style>
</head>
<body>
<div class="centrado" id="campoCentrado">
    <div class="menu principal" id="menu-principal">
        <p id="botonCrea" onclick="abreMenu('menu-creaEquipo')">Crear Equipo</p>
        <p id="botonLogin" onclick="">Usar Equipo Creado</p>
        <p id="botonInicia" onclick="preparar()">Clic para iniciar</p>
        <br>
        <p id="botonCreditos" onclick="abreMenu('menu-creditos')">Créditos</p>
    </div>
    <div class="menu creditos oculto" id="menu-creditos">
        <p onclick="vuelveMenu('menu-creditos')">Atrás</p>
        <p>
            <a href='https://www.freepik.com/vectors/light'>Light vector created by macrovector - www.freepik.com</a><br>
            <a href='https://www.freepik.com/vectors/background'>Background vector created by kjpargeter - www.freepik.com</a><br>
            <a href='https://www.freepik.com/vectors/background'>Background vector created by starline - www.freepik.com</a>
        </p>
    </div>
    <div class="menu creditos oculto" id="menu-creaEquipo">
        <p onclick="vuelveMenu('menu-creaEquipo')">Atrás</p>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <input class="mdl-textfield__input" id="input-equipo" name="equipo" type="text">
            <label class="mdl-textfield__label" for="input-equipo">Nombre del Equipo...</label>
        </div>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <input class="mdl-textfield__input" id="inptu-clave" name="clave" type="password">
            <label class="mdl-textfield__label" for="inptu-clave">Clave...</label>
        </div>
        <br>
        <!-- Accent-colored raised button with ripple -->
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored" id="button-crearEquipo" onclick="crearEquipo()">
            Crear
        </button>
        <div class="mdl-spinner mdl-js-spinner is-active oculto" id="div-creandoEquipo"></div>
    </div>
</div>
<canvas height="3" id="myCanvas" width="4"></canvas>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
<!-- MATERIAL DESIGN -->
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<!-- Load TensorFlow.js -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js"></script>
<script>
    'use strict';
    /*
    ███████╗██╗██████╗ ███████╗██████╗  █████╗ ███████╗███████╗
    ██╔════╝██║██╔══██╗██╔════╝██╔══██╗██╔══██╗██╔════╝██╔════╝
    █████╗  ██║██████╔╝█████╗  ██████╔╝███████║███████╗█████╗
    ██╔══╝  ██║██╔══██╗██╔══╝  ██╔══██╗██╔══██║╚════██║██╔══╝
    ██║     ██║██║  ██║███████╗██████╔╝██║  ██║███████║███████╗
    ╚═╝     ╚═╝╚═╝  ╚═╝╚══════╝╚═════╝ ╚═╝  ╚═╝╚══════╝╚══════╝
    */

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
        apiKey: 'AIzaSyBiI3Gsk7QsE39DvSZWmHd8oN-jvWh93vY',
        authDomain: 'ligafutbola.firebaseapp.com',
        projectId: 'ligafutbola',
        storageBucket: 'ligafutbola.appspot.com',
        messagingSenderId: '1009443859803',
        appId: '1:1009443859803:web:9fa8a2cf039e105c54be7e',
        measurementId: 'G-EHRYKGF37Z'
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

    function crearEquipo() {
        let clave = document.querySelector('[name=\'clave\']');
        if (clave.value.length < 5) {
            alert('La clave es muy simple');
            clave.value = '';
            return false;
        }
        let equipo = document.querySelector('[name=\'equipo\']');
        if (!esTextoUsuarioValido(equipo.value)) {
            alert('No es un nombre correcto');
            equipo.value = '';
            return false;
        }
        document.getElementById('div-creandoEquipo').classList.remove('oculto');
        document.getElementById('button-crearEquipo').classList.add('oculto');
        equipo.disabled = true;
        clave.disabled = true;
        setTimeout(preparar, 1000);
        /*
        firebase.auth().createUserWithEmailAndPassword(equipo.value + '@oswaldorodriguez.com', clave.value)
            .then((userCredential) => {
                // Signed in
                let user = userCredential.user;
                console.log(user);
                // ...
            })
            .catch(function(error) {
                // Handle Errors here.
                let errorCode = error.code;
                let errorMessage = error.message;
                if (errorCode == 'auth/weak-password') {
                    alert('La clave es muy simple.');
                } else {
                    alert(errorMessage);
                }
            });
         */
    }

    /**
     *
     * @param texto
     * @returns {boolean}
     */
    function esTextoUsuarioValido(texto) {
        let re = /\S+/;
        return re.test(texto);
    }

    /*
    ███╗   ███╗██╗   ██╗███╗   ██╗██████╗  ██████╗
    ████╗ ████║██║   ██║████╗  ██║██╔══██╗██╔═══██╗
    ██╔████╔██║██║   ██║██╔██╗ ██║██║  ██║██║   ██║
    ██║╚██╔╝██║██║   ██║██║╚██╗██║██║  ██║██║   ██║
    ██║ ╚═╝ ██║╚██████╔╝██║ ╚████║██████╔╝╚██████╔╝
    ╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═══╝╚═════╝  ╚═════╝
    */
    const ESTADO_PREPARANDO = 0;//Crear el mapa, canvas, cancha, inicio
    const ESTADO_ORDENANDO = 1;//arrastrar y soltar
    const ESTADO_JUGANDO = 2;//jugando
    const ESTADO_ENTRENANDO = 3;//pausaron para dar ordenens

    const POSESION_IZQ = -1;
    const POSESION_DER = 1;
    const POSESION_NADIE = 0;
    const TIEMPO_TOTAL = 300;
    const DOS_PI = Math.PI * 2;

    const INTERVALO_PENSAR = 250;

    let estaMoviRaton = false;
    let estado = ESTADO_PREPARANDO;
    let minX = 0;
    let minY = 0;
    let maxX = 0;
    let maxY = 0;
    let alto = 0;
    let ancho = 0;

    /*
     ███████╗ ██████╗ ██╗   ██╗██╗██████╗  ██████╗
     ██╔════╝██╔═══██╗██║   ██║██║██╔══██╗██╔═══██╗
     █████╗  ██║   ██║██║   ██║██║██████╔╝██║   ██║
     ██╔══╝  ██║▄▄ ██║██║   ██║██║██╔═══╝ ██║   ██║
     ███████╗╚██████╔╝╚██████╔╝██║██║     ╚██████╔╝
     ╚══════╝ ╚══▀▀═╝  ╚═════╝ ╚═╝╚═╝      ╚═════╝
     */
    class Equipo {

        constructor(izq) {
            this.jugadores = [];
            this.jugMoviendo = null;
            this.izquierda = izq;
            this.tUltPensa = izq ? INTERVALO_PENSAR / 2 : 0;
            let posiciones = [];
            let total = 11;
            do {
                let pos = (1 + Math.floor(Math.random() * 9)) + '' + (1 + Math.floor(Math.random() * 9));
                if (posiciones.indexOf(pos) === -1) {
                    posiciones.push(pos);
                    total--;
                }
            } while (total > 0);

            for (let i = 1; i <= 11; i++) {
                //Aleatorio en su lado de la cancha correspondiente
                let posx = parseInt(posiciones[i - 1].charAt(0));
                let posy = parseInt(posiciones[i - 1].charAt(1));
                let espacio = ancho / 2;

                let inicialX = minX + (this.izquierda ? 0 : ancho / 2) + (espacio / 10) * posx;
                let inicialY = minY + (alto / 10) * posy;

                let jug = new Jugador(this.izquierda, inicialX, inicialY);
                jug.actualizar();
                if (i === 1) {
                    jug.asignaArquero();
                }
                this.jugadores.push(jug);
            }
            this.cerebroA = new Cerebro(96, 286, 190);
            this.cerebroD = new Cerebro(96, 256, 160);
        }

        dibujar(ctx) {
            this.jugadores.forEach(function(jugador) {
                jugador.dibujar(ctx);
            });
        }

        /**
         *
         */
        actualizar(rival, balon, tengoPos, estadoPartido) {
            if (this.tUltPensa > INTERVALO_PENSAR) {
                console.log(this.izquierda ? 'Izq' : 'Der', 'Pensando');
                let entradas = this.percibir(rival, balon, estadoPartido);
                let acciones = this.pensar(entradas, tengoPos);
                this.actuar(acciones);
                this.tUltPensa = 0;
            }
            this.tUltPensa++;
            this.jugadores.forEach(function(jugador) {
                jugador.actualizar();
            });
        }

        /**
         * Normaliza la posicion del balon y todos los jugadores en cancha
         * el marcador, el tiempo, etc
         * @param {Equipo} rival
         * @param {Balon} balon
         * @param estadoPartido
         * @returns {[]}
         */
        percibir(rival, balon, estadoPartido) {
            let entradas = [];
            const { golesIzq, golesDer, posesIzq, posesDer, tiempRes } = estadoPartido;
            if (this.izquierda) {
                this.jugadores.forEach(function(jug) {
                    let { x, y, vel, angulo, maxVel } = jug.getVals();
                    entradas.push((x - minX) / ancho);
                    entradas.push((y - minY) / alto);
                    entradas.push(vel / maxVel);
                    entradas.push(angulo / DOS_PI);
                });
                rival.getJugadores().forEach(function(jug) {
                    let { x, y, vel, angulo, maxVel } = jug.getVals();
                    entradas.push((ancho - x - minX) / ancho);
                    entradas.push((alto - y - minY) / alto);
                    entradas.push(vel / maxVel);
                    entradas.push((angulo + Math.PI) / DOS_PI);
                });
                //balon
                let { x, y, vx, vy, vel, maxVel } = balon.getValores();
                entradas.push((x - minX) / ancho);
                entradas.push((y - minY) / alto);
                entradas.push(vx);
                entradas.push(vy);
                entradas.push(vel / maxVel);
                //esta ganando o perdiendo
                entradas.push(golesIzq > golesDer ? 1 : 0);
                //posesion porcentaje
                entradas.push(posesIzq / (posesIzq + posesDer));
            } else {
                this.jugadores.forEach(function(jug) {
                    let { x, y, vel, angulo, maxVel } = jug.getVals();
                    entradas.push((ancho - x - minX) / ancho);
                    entradas.push((alto - y - minY) / alto);
                    entradas.push(vel / maxVel);
                    entradas.push((angulo + Math.PI) / DOS_PI);
                });
                rival.getJugadores().forEach(function(jug) {
                    let { x, y, vel, angulo, maxVel } = jug.getVals();
                    entradas.push((x - minX) / ancho);
                    entradas.push((y - minY) / alto);
                    entradas.push(vel / maxVel);
                    entradas.push(angulo / DOS_PI);
                });
                //balon
                let { x, y, vx, vy, vel, maxVel } = balon.getValores();
                entradas.push((ancho - x - minX) / ancho);
                entradas.push((alto - y - minY) / alto);
                entradas.push(vx);
                entradas.push(vy);
                entradas.push(vel / maxVel);
                //esta ganando o perdiendo
                entradas.push(golesIzq < golesDer ? 1 : 0);
                //posesion porcentaje
                entradas.push(posesDer / (posesIzq + posesDer));
            }
            //tiempo restante
            entradas.push((TIEMPO_TOTAL - tiempRes) / TIEMPO_TOTAL);
            return entradas;
        }

        getJugadores() {
            return this.jugadores;
        }

        selecJugador(offsetX, offsetY) {
            let distanciaClic = (ancho + alto) / 100;
            for (let jug of this.jugadores) {
                const { x, y } = jug.getVals();
                if (distanciaClic > distancia(offsetX, offsetY, x + minX, y + minY)) {
                    this.jugMoviendo = jug;
                    return true;
                }
            }
            return false;
        }

        moverJugador(offsetX, offsetY) {
            if (this.jugMoviendo) {
                this.jugMoviendo.setXY(offsetX, offsetY);
                return true;
            } else {
                return false;
            }

        }

        sueltaJugador() {
            if (this.jugMoviendo) {
                this.jugMoviendo = null;
                return true;
            } else {
                return false;
            }
        }

        /**
         *
         * @param entradas
         * @param tengoPos
         * @returns {any}
         */
        pensar(entradas, tengoPos) {
            if (tengoPos) {
                return this.cerebroA.pensar(entradas);
            } else {
                return this.cerebroD.pensar(entradas);
            }
        }

        /**
         *
         * @param acciones
         * @returns {*}
         */
        actuar(acciones) {
            return acciones;
        }
    }

    /*
         ██╗██╗   ██╗ ██████╗  █████╗ ██████╗  ██████╗ ██████╗
         ██║██║   ██║██╔════╝ ██╔══██╗██╔══██╗██╔═══██╗██╔══██╗
         ██║██║   ██║██║  ███╗███████║██║  ██║██║   ██║██████╔╝
    ██   ██║██║   ██║██║   ██║██╔══██║██║  ██║██║   ██║██╔══██╗
    ╚█████╔╝╚██████╔╝╚██████╔╝██║  ██║██████╔╝╚██████╔╝██║  ██║
     ╚════╝  ╚═════╝  ╚═════╝ ╚═╝  ╚═╝╚═════╝  ╚═════╝ ╚═╝  ╚═╝
     */
    class Jugador {
        /**
         *
         * @param equipo
         * @param nuevoX
         * @param nuevoY
         */
        constructor(equipo, nuevoX, nuevoY) {
            this.tamano = (ancho + alto) / 400;
            this.maxVel = this.tamano * 7;
            this.esArquero = false;
            this.color = equipo ? 'blue' : 'red';
            this.x = nuevoX || 1;
            this.y = nuevoY || 1;
            this.vel = 0;
            this.angulo = equipo ? 0 : Math.PI;//mira a la izquierda o derecha
            this.izquierda = equipo;
        };

        /**
         *
         * @param ctx
         */
        dibujar(ctx) {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.tamano, 0, DOS_PI);
            ctx.fillStyle = this.color;
            ctx.fill();
            ctx.lineWidth = 1;
            ctx.arc(this.x, this.y, this.tamano, 0, DOS_PI);
            ctx.strokeStyle = this.esArquero ? 'white' : 'black';
            ctx.stroke();
            ctx.closePath();
        };

        /**
         *
         */
        actualizar() {
            this.x = this.x + Math.cos(this.angulo) * this.vel;
            this.y = this.y + Math.sin(this.angulo) * this.vel;
        };

        /**
         *
         */
        asignaArquero() {
            this.esArquero = true;
            this.x = this.izquierda ? minX + this.tamano * 2 : minX + ancho - this.tamano * 2;
            this.y = minY + alto / 2;
        };

        /**
         *
         * @param offsetX
         * @param offsetY
         */
        setXY(offsetX, offsetY) {
            this.x = offsetX;
            this.y = offsetY;

        };

        /**
         *
         * @returns {{maxVel: number, x: *, y: number, angulo: number, vel: number}}
         */
        getVals() {
            return {
                'x': this.x,
                'y': this.y,
                'vel': this.vel,
                'angulo': this.angulo,
                'maxVel': this.maxVel
            };
        };

    }

    /*
    ██████╗  █████╗ ██╗      ██████╗ ███╗   ██╗
    ██╔══██╗██╔══██╗██║     ██╔═══██╗████╗  ██║
    ██████╔╝███████║██║     ██║   ██║██╔██╗ ██║
    ██╔══██╗██╔══██║██║     ██║   ██║██║╚██╗██║
    ██████╔╝██║  ██║███████╗╚██████╔╝██║ ╚████║
    ╚═════╝ ╚═╝  ╚═╝╚══════╝ ╚═════╝ ╚═╝  ╚═══╝
     */
    class Balon {
        /**
         *
         */
        constructor() {
            this.tamano = (ancho + alto) / 500;
            this.maxVel = this.tamano * 7;
            this.friccion = 0.0001;
            this.x = minX + ancho / 2;
            this.y = minY + alto / 2;
            this.vx = 0;
            this.vy = 0;
            this.vel = 0;
        }

        /**
         *
         * @param ctx
         */
        dibujar(ctx) {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.tamano, 0, DOS_PI);
            ctx.fillStyle = 'white';
            ctx.fill();
            ctx.closePath();
        };

        /**
         *
         */
        actualizar() {
            this.vel = this.vel > this.maxVel ? this.maxVel : (this.vel <= 0.1 ? 0 : this.vel);

            if (this.x + this.vx * this.vel > maxX || this.x + this.vx * this.vel < minX) {
                this.vx = -this.vx;
            }
            if (this.y + this.vy * this.vel > maxY || this.y + this.vy * this.vel < minY) {
                this.vy = -this.vy;
            }
            this.x = this.x + this.vx * this.vel;
            this.y = this.y + this.vy * this.vel;
            this.vel = this.vel - this.friccion;
        };

        /**
         *
         * @param nuevoX
         * @param nuevoY
         * @param nuevoVelX
         * @param nuevoVelY
         * @param nuevoV
         */
        setValores(nuevoX, nuevoY, nuevoVelX, nuevoVelY, nuevoV) {
            this.x = nuevoX || this.x;
            this.y = nuevoY || this.y;
            this.vx = nuevoVelX || this.vx;
            this.vy = nuevoVelY || this.vy;
            this.vel = nuevoV || this.vel;
        };

        /**
         *
         * @returns {{vx: Balon.getValores.vx, vy: Balon.getValores.vy, maxVel: Balon.getValores.maxVel, x: Balon.getValores.x, y: Balon.getValores.y, vel: Balon.getValores.vel}}
         */
        getValores = function() {
            return {
                'x': this.x,
                'y': this.y,
                'vx': this.vx,
                'vy': this.vy,
                'vel': this.vel,
                'maxVel': this.maxVel
            };
        };

    }

    /*
         ██╗██╗   ██╗███████╗ ██████╗  ██████╗
         ██║██║   ██║██╔════╝██╔════╝ ██╔═══██╗
         ██║██║   ██║█████╗  ██║  ███╗██║   ██║
    ██   ██║██║   ██║██╔══╝  ██║   ██║██║   ██║
    ╚█████╔╝╚██████╔╝███████╗╚██████╔╝╚██████╔╝
     ╚════╝  ╚═════╝ ╚══════╝ ╚═════╝  ╚═════╝
     */
    class Juego {

        constructor(elctx) {
            this.ctx = elctx;

            let bordes = 1 / 100;

            minX = this.ctx.canvas.width * bordes;
            minY = this.ctx.canvas.height * bordes;
            maxX = this.ctx.canvas.width - this.ctx.canvas.width * bordes;
            maxY = this.ctx.canvas.height - this.ctx.canvas.height * bordes;
            alto = maxY - minY;
            ancho = maxX - minX;

            this.bombaAncho = ancho / 7;
            this.bombaAlto = alto / 2;
            this.bombaMinY = minY + alto / 4;
            this.bombaDerMinX = maxX - this.bombaAncho;
            this.bombaChicaAncho = ancho / 18;
            this.bombaChicaAlto = alto / 4;
            this.bombaChicaMinY = this.bombaMinY + alto / 8;
            this.bombaChicaDerMinX = maxX - this.bombaChicaAncho;
            this.bombaIzqMinXRadio = minX + this.bombaAncho;
            this.mitadX = this.ctx.canvas.width / 2;
            this.mitadY = this.ctx.canvas.height / 2;
            this.radioCentro = this.bombaAncho / 3;
            this.radioCompleto = DOS_PI;
            this.radioMitad = Math.PI / 2;
            this.radioAngulo = Math.PI;
            this.porteriaMinY = minY + 4 * alto / 9;
            this.porteriaMaxY = alto / 9;

            this.tiempoAnt = 0;
            this.golesIzq = 0;
            this.golesDer = 0;
            this.tiempRes = 0;
            this.posesIzq = 1;
            this.posesDer = 1;
            this.posesion = POSESION_NADIE;

            this.equipoA = new Equipo(true);
            this.equipoB = new Equipo(false);
            this.balon = new Balon();
            //Pasa de estado previo a estado ordenando
            estado = ESTADO_ORDENANDO;
        }

        ratonClic(offsetX, offsetY) {
            if (!this.equipoA.selecJugador(offsetX, offsetY)) {
                this.equipoB.selecJugador(offsetX, offsetY);
            }
        };

        ratonMueve(offsetX, offsetY) {
            if (!this.equipoA.moverJugador(offsetX, offsetY)) {
                this.equipoB.moverJugador(offsetX, offsetY);
            }
        };

        ratonSuelta() {
            if (!this.equipoA.sueltaJugador()) {
                this.equipoB.sueltaJugador();
            }
        };

        /**
         *
         * @param elctx
         */
        dibujarCampo(elctx) {
            elctx.strokeStyle = 'white';
            elctx.lineWidth = 1;
            //dibujamos el fondo verde
            elctx.beginPath();
            elctx.rect(0, 0, elctx.canvas.width, elctx.canvas.height);
            elctx.fillStyle = 'rgba(0, 120, 24, 0.9)';
            elctx.fill();
            elctx.closePath();

            //bordes de la cancha
            elctx.beginPath();
            elctx.rect(minX, minY, ancho, alto);
            elctx.stroke();
            elctx.closePath();

            //bomba izquierda y derecha
            elctx.beginPath();
            elctx.rect(minX, this.bombaMinY, this.bombaAncho, this.bombaAlto);
            elctx.stroke();
            elctx.closePath();
            elctx.beginPath();
            elctx.rect(minX, this.bombaChicaMinY, this.bombaChicaAncho, this.bombaChicaAlto);
            elctx.stroke();
            elctx.closePath();
            elctx.beginPath();
            elctx.arc(this.bombaIzqMinXRadio, this.mitadY, this.radioCentro, -this.radioMitad, this.radioMitad);
            elctx.stroke();
            elctx.closePath();
            elctx.beginPath();
            elctx.rect(this.bombaDerMinX, this.bombaMinY, this.bombaAncho, this.bombaAlto);
            elctx.stroke();
            elctx.closePath();
            elctx.beginPath();
            elctx.arc(this.bombaDerMinX, this.mitadY, this.radioCentro, this.radioMitad, -this.radioMitad);
            elctx.stroke();
            elctx.closePath();
            elctx.beginPath();
            elctx.rect(this.bombaChicaDerMinX, this.bombaChicaMinY, this.bombaChicaAncho, this.bombaChicaAlto);
            elctx.stroke();
            elctx.closePath();

            //linea de la mitad y circulo
            elctx.beginPath();
            elctx.rect(this.mitadX, minY, 0, alto);
            elctx.stroke();
            elctx.closePath();
            elctx.beginPath();
            elctx.arc(this.mitadX, this.mitadY, this.radioCentro, 0, this.radioCompleto);
            elctx.stroke();
            elctx.closePath();

            //porterias
            elctx.beginPath();
            elctx.rect(0, this.porteriaMinY, minX, this.porteriaMaxY);
            elctx.stroke();
            elctx.closePath();
            elctx.beginPath();
            elctx.rect(maxX, this.porteriaMinY, minX, this.porteriaMaxY);
            elctx.stroke();
            elctx.closePath();
        }

        /**
         *
         */
        dibujar() {
            //Limpiar
            this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);
            this.dibujarCampo(this.ctx);
            //equipos
            this.equipoA.dibujar(this.ctx);
            this.equipoB.dibujar(this.ctx);
            this.balon.dibujar(this.ctx);
        }

        /**
         *
         */
        actualizar() {
            if (estado === ESTADO_JUGANDO) {
                this.balon.actualizar();
                let estadoPartido = {
                    golesIzq: this.golesIzq,
                    golesDer: this.golesDer,
                    posesIzq: this.posesIzq,
                    posesDer: this.posesDer,
                    tiempRes: this.tiempRes
                };
                this.equipoA.actualizar(this.equipoB, this.balon, this.posesion === POSESION_IZQ, estadoPartido);
                this.equipoB.actualizar(this.equipoA, this.balon, this.posesion === POSESION_DER, estadoPartido);
            }
        }

        /**
         *
         */
        ciclo(tiempo) {
            let deltaTiempo = tiempo - this.tiempoAnt;
            this.actualizar();
            this.dibujar();
            requestAnimationFrame(this.ciclo.bind(this));
        }


    }

    /*
     ██████╗███████╗██████╗ ███████╗██████╗ ██████╗  ██████╗
    ██╔════╝██╔════╝██╔══██╗██╔════╝██╔══██╗██╔══██╗██╔═══██╗
    ██║     █████╗  ██████╔╝█████╗  ██████╔╝██████╔╝██║   ██║
    ██║     ██╔══╝  ██╔══██╗██╔══╝  ██╔══██╗██╔══██╗██║   ██║
    ╚██████╗███████╗██║  ██║███████╗██████╔╝██║  ██║╚██████╔╝
     ╚═════╝╚══════╝╚═╝  ╚═╝╚══════╝╚═════╝ ╚═╝  ╚═╝ ╚═════╝
    */
    class Cerebro {
        constructor(e, o, s) {
            this.nodosEntradas = e;
            this.nodosOcultas = o;
            this.nodosSalidas = s;
            this.crearModelo();
        }

        crearModelo() {
            this.modelo = tf.sequential();
            /*const ocultas = tf.layers.dense({
                units: this.nodosOcultas,
                inputShape: [this.nodosEntradas],
                activation: 'sigmoid'
            });

            this.model.add(ocultas);

            const salidas = tf.layers.dense({
                units: this.nodosSalidas,
                activation: 'sigmoid'
            });

            this.modelo.add(salidas);*/
        }

        /**
         *
         * @param entradas
         * @returns {*}
         */
        pensar(entradas) {
            const xs = tf.tensor2d([entradas]);
            const ys = this.modelo.predict2D(xs);
            return ys.dataSync();
        }
    }

    /**
     *
     * @param x1
     * @param y1
     * @param x2
     * @param y2
     * @returns {number}
     */
    function distancia(x1, y1, x2, y2) {
        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
    }

    /*
    ████████╗███████╗███╗   ███╗██████╗  ██████╗ ██████╗  █████╗ ██╗
    ╚══██╔══╝██╔════╝████╗ ████║██╔══██╗██╔═══██╗██╔══██╗██╔══██╗██║
       ██║   █████╗  ██╔████╔██║██████╔╝██║   ██║██████╔╝███████║██║
       ██║   ██╔══╝  ██║╚██╔╝██║██╔═══╝ ██║   ██║██╔══██╗██╔══██║██║
       ██║   ███████╗██║ ╚═╝ ██║██║     ╚██████╔╝██║  ██║██║  ██║███████╗
       ╚═╝   ╚══════╝╚═╝     ╚═╝╚═╝      ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝
     */

    /**
     * Inicia los datos para comenzar la partida
     */
    function preparar() {
        document.getElementById('campoCentrado').remove();

        const ancho = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        const alto = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);

        document.getElementById('myCanvas');
        let canvas = document.getElementById('myCanvas');
        let ctx = canvas.getContext('2d');

        ctx.canvas.width = ancho;
        ctx.canvas.height = alto;

        let juego = new Juego(ctx);
        juego.ciclo(1);

        let x = 0;
        let y = 0;

        let dibujar = function(x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            ctx.closePath();
        };

        canvas.addEventListener('mousedown', e => {
            if (estado === ESTADO_JUGANDO) return;
            x = e.offsetX;
            y = e.offsetY;
            estaMoviRaton = true;
            switch (estado) {
                case ESTADO_ENTRENANDO:
                    break;
                case ESTADO_ORDENANDO:
                    juego.ratonClic(e.offsetX, e.offsetY);
                    break;
                default:
                    break;
            }
        });

        canvas.addEventListener('mousemove', e => {
            if (estado === ESTADO_JUGANDO || !estaMoviRaton) return;
            switch (estado) {
                case ESTADO_ENTRENANDO:
                    dibujar(x, y, e.offsetX, e.offsetY);
                    x = e.offsetX;
                    y = e.offsetY;
                    break;
                case ESTADO_ORDENANDO:
                    juego.ratonMueve(e.offsetX, e.offsetY);
                    break;
                default:
                    break;
            }
        });

        window.addEventListener('mouseup', e => {
            estaMoviRaton = false;
            if (estado === ESTADO_JUGANDO) return;
            switch (estado) {
                case ESTADO_ENTRENANDO:
                    dibujar(x, y, e.offsetX, e.offsetY);
                    x = 0;
                    y = 0;
                    break;
                case ESTADO_ORDENANDO:
                    juego.ratonSuelta();
                    break;
                default:
                    break;
            }
        });

        probarTF();

    }

    function probarTF() {
        const model = tf.sequential();
        model.add(tf.layers.dense({
            units: 1,
            inputShape: [1]
        }));

        // Prepare the model for training: Specify the loss and the optimizer.
        model.compile({
            loss: 'meanSquaredError',
            optimizer: 'sgd'
        });

        // Generate some synthetic data for training.
        const xs = tf.tensor2d([1, 2, 3, 4], [4, 1]);
        const ys = tf.tensor2d([1, 3, 5, 7], [4, 1]);

        // Train the model using the data.
        model.fit(xs, ys).then(() => {
            // Use the model to do inference on a data point the model hasn't seen before:
            // Open the browser devtools to see the output
            model.predict(tf.tensor2d([5], [1, 1])).print();
        });
    }

    window.addEventListener('keyup', function(event) {
        if (event.key !== undefined) {
            tecleo(event.key, 'Key');
        } else if (event.keyIdentifier !== undefined) {
            tecleo(event.keyIdentifier, 'keyIdentifier');
        } else if (event.keyCode !== undefined) {
            tecleo(event.keyCode, 'keyCode');
        }
    }, false);

    function tecleo(evento, tipo) {
        switch (evento) {
            case 'ArrowUp':
                break;
            case 'ArrowDown':
                break;
            case 'Enter':
                if (estado === ESTADO_ORDENANDO) {
                    alert('Inicia Juego');
                    estado = ESTADO_JUGANDO;
                }
                break;
            case 'a':
                entrenar();
                break;
            default:
                break;
        }
        console.log(evento, tipo);
    }

    function abreMenu(idElem) {
        document.getElementById('menu-principal').classList.add('oculto');
        let elemento = document.getElementById(idElem);
        elemento.classList.remove('oculto');
    }

    function vuelveMenu(idElem) {
        let elemento = document.getElementById(idElem);
        elemento.classList.add('oculto');
        document.getElementById('menu-principal').classList.remove('oculto');
    }

    /**
     * TEPORAL
     */
    setTimeout(preparar, 100);
</script>
</body>
</html>
