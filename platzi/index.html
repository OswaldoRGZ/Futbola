<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <!-- MATERIAL DESIGN -->
    <link href="https://code.getmdl.io/1.3.0/material.teal-pink.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta content="#ffffff" name="theme-color">
    <link href="favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
    <title>Login - Futbola</title>
    <style>
        .centrado {
            width: 50%;
            max-width: 960px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            position: absolute;
            text-align: center;
            background: url(fondo-menu.jpg) no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            height: 70vh;
            min-height: 50vh;
        }

        * {
            padding: 0;
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
        }

        body {
            background: url(fondo-inicio.jpg) no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }

        .menu {
            margin: 25vh;
        }

        .menu > p {
            margin-top: 1vh;
        }

        .oculto {
            visibility: hidden;
            position: absolute;
        }
    </style>
</head>
<body>
<div class="centrado" id="campoCentrado">
    <div class="menu principal" id="menu-principal">
        <p id="botonCrea" onclick="abreMenu('menu-creaEquipo')">Crear Equipo</p>
        <p id="botonLogin" onclick="">Usar Equipo Creado</p>
        <p id="botonInicia" onclick="preparar()">Clic para iniciar</p>
        <br>
        <p id="botonCreditos" onclick="abreMenu('menu-creditos')">Créditos</p>
    </div>
    <div class="menu creditos oculto" id="menu-creditos">
        <p onclick="vuelveMenu('menu-creditos')">Atrás</p>
        <p>
            <a href='https://www.freepik.com/vectors/light'>Light vector created by macrovector - www.freepik.com</a><br>
            <a href='https://www.freepik.com/vectors/background'>Background vector created by kjpargeter - www.freepik.com</a><br>
            <a href='https://www.freepik.com/vectors/background'>Background vector created by starline - www.freepik.com</a>
        </p>
    </div>
    <div class="menu creditos oculto" id="menu-creaEquipo">
        <p onclick="vuelveMenu('menu-creaEquipo')">Atrás</p>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <input class="mdl-textfield__input" id="input-equipo" name="equipo" type="text">
            <label class="mdl-textfield__label" for="input-equipo">Nombre del Equipo...</label>
        </div>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <input class="mdl-textfield__input" id="inptu-clave" name="clave" type="password">
            <label class="mdl-textfield__label" for="inptu-clave">Clave...</label>
        </div>
        <br>
        <!-- Accent-colored raised button with ripple -->
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored" id="button-crearEquipo" onclick="crearEquipo()">
            Crear
        </button>
        <div class="mdl-spinner mdl-js-spinner is-active oculto" id="div-creandoEquipo"></div>
    </div>
</div>
<canvas height="3" id="myCanvas" width="4"></canvas>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
<script>
    'use strict';

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
        apiKey: 'AIzaSyBiI3Gsk7QsE39DvSZWmHd8oN-jvWh93vY',
        authDomain: 'ligafutbola.firebaseapp.com',
        projectId: 'ligafutbola',
        storageBucket: 'ligafutbola.appspot.com',
        messagingSenderId: '1009443859803',
        appId: '1:1009443859803:web:9fa8a2cf039e105c54be7e',
        measurementId: 'G-EHRYKGF37Z'
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

    function crearEquipo() {
        let clave = document.querySelector('[name=\'clave\']');
        if (clave.value.length < 5) {
            alert('La clave es muy simple');
            clave.value = '';
            return false;
        }
        let equipo = document.querySelector('[name=\'equipo\']');
        if (!esTextoUsuarioValido(equipo.value)) {
            alert('No es un nombre correcto');
            equipo.value = '';
            return false;
        }
        document.getElementById('div-creandoEquipo').classList.remove('oculto');
        document.getElementById('button-crearEquipo').classList.add('oculto');
        equipo.disabled = true;
        clave.disabled = true;
        setTimeout(preparar, 1000);
        /*
        firebase.auth().createUserWithEmailAndPassword(equipo.value + '@oswaldorodriguez.com', clave.value)
            .then((userCredential) => {
                // Signed in
                let user = userCredential.user;
                console.log(user);
                // ...
            })
            .catch(function(error) {
                // Handle Errors here.
                let errorCode = error.code;
                let errorMessage = error.message;
                if (errorCode == 'auth/weak-password') {
                    alert('La clave es muy simple.');
                } else {
                    alert(errorMessage);
                }
            });
         */
    }

    /**
     *
     * @param texto
     * @returns {boolean}
     */
    function esTextoUsuarioValido(texto) {
        let re = /\S+/;
        return re.test(texto);
    }

</script>
<!-- MATERIAL DESIGN -->
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<script>
    const ORDENANDO = 0;
    const JUGANDO = 1;
    const ENTRENANDO = 2;

    let estaMoviRaton = false;
    let estado = -1;

    function Juego() {
        const arCompleto = Math.PI * 2;
        let ctx = null;

        let equipoA = null;
        let equipoB = null;
        let balon = null;


        let bombaAncho = 0;
        let bombaAlto = 0;
        let bombaMinY = 0;
        let bombaDerMinX = 0;
        let mitadX;
        let mitadY;
        let radioCentro;
        let radioCompleto;
        let radioMitad;
        let radioAngulo;
        let bombaIzqMinXRadio;
        let bombaChicaAncho;
        let bombaChicaAlto;
        let bombaChicaMinY;
        let bombaChicaDerMinX;
        let porteriaMinY;
        let porteriaMaxY;

        let minX = 0;
        let minY = 0;
        let alto = 0;
        let ancho = 0;
        let maxX = 0;
        let maxY = 0;

        function Jugador() {
            const tamano = (ancho + alto) / 400;
            let x = 0;
            let y = 0;
            let angulo = 0;
            let vel = 0;
            let color;
            let esArquero = false;
            let izquierda = true;

            this.iniciar = function(equipo, nuevoX, nuevoY) {
                color = equipo ? 'blue' : 'red';
                x = nuevoX || Math.random() * ancho;
                y = nuevoY || alto / 4 + Math.random() * alto / 2;
                angulo = equipo ? 0 : Math.PI;//mira a la izquierda o derecha
                izquierda = equipo;
            };

            this.dibujar = function(ctx) {
                ctx.beginPath();
                ctx.arc(x, y, tamano, 0, arCompleto);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.lineWidth = 1;
                ctx.arc(x, y, tamano, 0, arCompleto);
                ctx.strokeStyle = esArquero ? 'white' : 'black';
                ctx.stroke();
                ctx.closePath();
            };

            this.actualizar = function(nuevoX, nuevoY) {
                x = nuevoX || x;
                y = nuevoY || y;
            };

            this.asignaArquero = function() {
                esArquero = true;
                x = izquierda ? tamano * 2 : ancho - tamano * 2;
                y = alto / 2;
            };

            this.getX = function() {
                return x;
            };

            this.getY = function() {
                return y;
            };

            this.setXY = function(offsetX, offsetY) {
                x = offsetX;
                y = offsetY;
            };

        }

        function Equipo() {
            let jugadores = [];
            let jugMoviendo = null;

            this.dibujar = function(ctx) {
                jugadores.forEach(function(jugador) {
                    jugador.dibujar(ctx);
                });
            };

            this.actualizar = function() {
                jugadores.forEach(function(jugador) {
                    jugador.actualizar();
                });
            };

            this.iniciar = function(izquierda) {
                for (let i = 1; i <= 11; i++) {
                    let jug = new Jugador();
                    //Aleatorio en su lado de la cancha correspondiente
                    let inicialX = izquierda ? Math.random() * ancho / 2 : ancho / 2 + Math.random() * ancho / 2;
                    jug.iniciar(izquierda, inicialX);
                    jug.actualizar();
                    if (i === 1) {
                        jug.asignaArquero();
                    }
                    jugadores.push(jug);
                }
            };

            this.selecJugador = function(offsetX, offsetY) {
                let distanciaClic = (ancho + alto) / 100;
                jugadores.forEach(function(jug) {
                    if (distanciaClic > distancia(offsetX, offsetY, jug.getX(), jug.getY())) {
                        jugMoviendo = jug;
                        return true;
                    }
                });
                return false;
            };


            this.moverJugador = function(offsetX, offsetY) {
                if (jugMoviendo) {
                    jugMoviendo.setXY(offsetX, offsetY);
                    return true;
                } else {
                    return false;
                }

            };

            this.sueltaJugador = function() {
                if (jugMoviendo) {
                    jugMoviendo = null;
                    return true;
                } else {
                    return false;
                }

            };
        }

        function Balon() {
            const tamano = (ancho + alto) / 500;
            const maxVel = tamano * 7;

            let x = 0;
            let y = 0;
            let vx = 0;
            let vy = 0;
            let vel = 0;

            this.dibujar = function(ctx) {
                ctx.beginPath();
                ctx.arc(x, y, tamano, 0, arCompleto);
                ctx.fillStyle = '#FFF';
                ctx.fill();
                ctx.closePath();
            };
            this.actualizar = function(nuevoX, nuevoY, nuevoVelX, nuevoVelY, nuevoV) {
                x = nuevoX || x;
                y = nuevoY || y;
                vx = nuevoVelX || vx;
                vy = nuevoVelY || vy;
                vel = nuevoV || vel;
                vel = vel > maxVel ? maxVel : vel;
                if (x + vx * vel > maxX || x + vx * vel < minX) {
                    vx = -vx;
                    vel++;
                }
                if (y + vy * vel > maxY || y + vy * vel < minY) {
                    vy = -vy;
                    vel++;
                }
                x = x + vx * vel;
                y = y + vy * vel;
            };
            this.iniciar = function() {
                x = minX + ancho / 2;
                y = minY + alto / 2;
            };

        }

        this.inicia = function(elctx) {
            ctx = elctx;
            let bordes = 1 / 100;
            minX = ctx.canvas.width * bordes;
            minY = ctx.canvas.height * bordes;
            maxX = ctx.canvas.width - ctx.canvas.width * bordes;
            maxY = ctx.canvas.height - ctx.canvas.height * bordes;

            alto = maxY - minY;
            ancho = maxX - minX;

            bombaAncho = ancho / 7;
            bombaAlto = alto / 2;
            bombaMinY = minY + alto / 4;
            bombaDerMinX = maxX - bombaAncho;

            bombaChicaAncho = ancho / 18;
            bombaChicaAlto = alto / 4;
            bombaChicaMinY = bombaMinY + alto / 8;
            bombaChicaDerMinX = maxX - bombaChicaAncho;

            bombaIzqMinXRadio = minX + bombaAncho;

            mitadX = ctx.canvas.width / 2;
            mitadY = ctx.canvas.height / 2;

            radioCentro = bombaAncho / 3;
            radioCompleto = arCompleto;
            radioMitad = Math.PI / 2;
            radioAngulo = Math.PI;

            porteriaMinY = minY + 4 * alto / 9;
            porteriaMaxY = alto / 9;

            balon = new Balon();

            equipoA = new Equipo();//true para izquierda
            equipoB = new Equipo();//false para derecha
            equipoA.iniciar(true);
            equipoB.iniciar(false);
            balon.iniciar();
            //ahora pasamos al modo ordenar equipo
            estado = ORDENANDO;

            ciclo();
        };

        this.ratonClic = function(offsetX, offsetY) {
            if (!equipoA.selecJugador(offsetX, offsetY)) {
                equipoB.selecJugador(offsetX, offsetY);
            }
        };

        this.ratonMueve = function(offsetX, offsetY) {
            if (!equipoA.moverJugador(offsetX, offsetY)) {
                equipoB.moverJugador(offsetX, offsetY);
            }
        };

        this.ratonSuelta = function() {
            if (!equipoA.sueltaJugador()) {
                equipoB.sueltaJugador();
            }
        };

        function dibujarCampo() {
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 1;
            //dibujamos el fondo verde
            ctx.beginPath();
            ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);
            ctx.fillStyle = 'rgba(0, 120, 24, 0.9)';
            ctx.fill();
            ctx.closePath();

            //bordes de la cancha
            ctx.beginPath();
            ctx.rect(minX, minY, ancho, alto);
            ctx.stroke();
            ctx.closePath();

            //bomba izquierda y derecha
            ctx.beginPath();
            ctx.rect(minX, bombaMinY, bombaAncho, bombaAlto);
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.rect(minX, bombaChicaMinY, bombaChicaAncho, bombaChicaAlto);
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.arc(bombaIzqMinXRadio, mitadY, radioCentro, -radioMitad, radioMitad);
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.rect(bombaDerMinX, bombaMinY, bombaAncho, bombaAlto);
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.arc(bombaDerMinX, mitadY, radioCentro, radioMitad, -radioMitad);
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.rect(bombaChicaDerMinX, bombaChicaMinY, bombaChicaAncho, bombaChicaAlto);
            ctx.stroke();
            ctx.closePath();

            //linea de la mitad y circulo
            ctx.beginPath();
            ctx.rect(mitadX, minY, 0, alto);
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.arc(mitadX, mitadY, radioCentro, 0, radioCompleto);
            ctx.stroke();
            ctx.closePath();

            //porterias
            ctx.beginPath();
            ctx.rect(0, porteriaMinY, minX, porteriaMaxY);
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
            ctx.rect(maxX, porteriaMinY, minX, porteriaMaxY);
            ctx.stroke();
            ctx.closePath();
        }

        function dibujar() {
            //Limpiar
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            dibujarCampo();
            //equipos
            equipoA.dibujar(ctx);
            equipoB.dibujar(ctx);
            balon.dibujar(ctx);
        }

        function actualizar() {
            if (estado === JUGANDO) {
                balon.actualizar();
                equipoA.actualizar();
                equipoB.actualizar();
            }
        }

        function ciclo() {
            actualizar();
            dibujar();
            //setTimeout(ciclo, intervalo);
            requestAnimationFrame(ciclo);
        }

        function distancia(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }
    }

    /**
     * Inicia los datos para comenzar la partida
     */
    function preparar() {
        document.getElementById('campoCentrado').remove();

        const ancho = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        const alto = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);

        document.getElementById('myCanvas');
        let canvas = document.getElementById('myCanvas');
        let ctx = canvas.getContext('2d');

        ctx.canvas.width = ancho;
        ctx.canvas.height = alto;

        let juego = new Juego();
        juego.inicia(ctx);

        let x = 0;
        let y = 0;

        let dibujar = function(x1, y1, x2, y2) {
            ctx.beginPath();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            ctx.closePath();
        };

        canvas.addEventListener('mousedown', e => {
            if (estado === JUGANDO) return;
            x = e.offsetX;
            y = e.offsetY;
            estaMoviRaton = true;
            switch (estado) {
                case ENTRENANDO:
                    break;
                case ORDENANDO:
                    juego.ratonClic(e.offsetX, e.offsetY);
                    break;
                default:
                    break;
            }
        });

        canvas.addEventListener('mousemove', e => {
            if (estado === JUGANDO || !estaMoviRaton) return;
            switch (estado) {
                case ENTRENANDO:
                    dibujar(x, y, e.offsetX, e.offsetY);
                    x = e.offsetX;
                    y = e.offsetY;
                    break;
                case ORDENANDO:
                    juego.ratonMueve(e.offsetX, e.offsetY);
                    break;
                default:
                    break;
            }
        });

        window.addEventListener('mouseup', e => {
            estaMoviRaton = false;
            if (estado === JUGANDO) return;
            switch (estado) {
                case ENTRENANDO:
                    dibujar(x, y, e.offsetX, e.offsetY);
                    x = 0;
                    y = 0;
                    break;
                case ORDENANDO:
                    juego.ratonSuelta();
                    break;
                default:
                    break;
            }
        });

    }

    window.addEventListener('keyup', function(event) {
        if (event.key !== undefined) {
            tecleo(event.key, 'Key');
        } else if (event.keyIdentifier !== undefined) {
            tecleo(event.keyIdentifier, 'keyIdentifier');
        } else if (event.keyCode !== undefined) {
            tecleo(event.keyCode, 'keyCode');
        }
    }, false);

    function tecleo(evento, tipo) {
        switch (evento) {
            case 'ArrowUp':
                break;
            case 'ArrowDown':
                break;
            default:
                break;
        }
    }

    function abreMenu(idElem) {
        document.getElementById('menu-principal').classList.add('oculto');
        let elemento = document.getElementById(idElem);
        elemento.classList.remove('oculto');
    }

    function vuelveMenu(idElem) {
        let elemento = document.getElementById(idElem);
        elemento.classList.add('oculto');
        document.getElementById('menu-principal').classList.remove('oculto');
    }

    /**
     * TEPORAL
     */
    setTimeout(preparar, 100);
</script>
</body>
</html>
